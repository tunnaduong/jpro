<script>
  var id_url = location.pathname.split("/")[2];

  function changePost(data) {
    $("#detail").css("display", "block");
    $("#post_title").text(data.title);
    $("#author-name").text(data.author);
    $("#post_date").text(
      moment(data.date_posted).locale("vi").format("Do MMMM YYYY, H:mm:ss")
    );
    $("#post_content").text(data.content);
  }

  (async function getPostDetail(id) {
    try {
      const response = await axiosInstance.get("/post/" + id + "/");
      console.log(response);
      changePost(response.data);
      return response.data;
    } catch (error) {
      if (error.response) {
        console.log("failed");
        console.log(error.response.data);
        $.ajax({
          url: "/pages/errors/404.html",
          success: function (ajaxData) {
            $("#include-content").html(ajaxData);
          },
          async: false,
        });
        $("#404").css("visibility", "visible");
      }
    }
  })(id_url);
</script>
<div id="detail" style="display: none">
  <div id="title" class="container">
    <h2 class="title" id="post_title">Buổi chia sẻ kiến thức</h2>
    <div class="detail-title">
      <div class="left">
        <a href="/pbhuu/profile">
          <div class="author cover-box" id="author-name">Lê Thanh Bình</div>
        </a>
        <div class="date" id="post_date">Mar 08, 2022 22:30</div>
      </div>
      <div class="right">
        <a href="/discussions">
          <div class="return cover-box more">
            <span
              >Trang thảo luận<i class="fas fa-long-arrow-alt-right"></i
            ></span>
          </div>
        </a>
      </div>
    </div>
  </div>
  <div class="image-cover">
    <img id="cover_img" src="../../static/images/JS.png" alt="Cover Image" />
    <div id="subtitle">
      <div class="subtitle-wrapper">
        <div class="summary-wrapper">
          <div class="dropcaps subtitle" id="post_excerpt">
            GitLab là một hệ thống quản lý dự án và phiên bản code, hoạt động
            giống như một mạng xã hội cho lập trình viên. Các lập trình viên có
            thể clone lại mã nguồn từ một repository và Gitlab chính là một dịch
            vụ máy chủ repository công cộng, mỗi người có thể tạo tài khoản trên
            đó để tạo ra các kho chứa của riêng mình để có thể làm việc.
          </div>
        </div>
      </div>
    </div>
  </div>
  <div id="content">
    <div class="container discuss-detail-content" id="post_content"></div>
    <hr />
    <div class="container count">
      <div>
        <i class="far fa-heart heart"></i>
        <span class="number">35</span> likes
      </div>
      <div>
        <i class="far fa-comment-alt"></i>
        <span class="number">35</span> comments
      </div>
      <div>
        <i class="far fa-share-square"></i>
        <span class="number">10</span> chia sẻ
      </div>
      <div>
        <i class="far fa-eye"></i> <span class="number">2,5k</span> views
      </div>
    </div>
    <hr />
    <div class="discuss-comments container">
      <div class="comment-wrapper">
        <div class="comment-container">
          <div class="comment">
            <div class="user">
              <img
                src="../../static/images/SHIP 2.png"
                class="user-image"
                alt=""
              />
              <div class="user-detail">
                <div class="username">Trần Thùy Trang</div>
                <div class="time-comment">
                  30 phút trước · <i class="fas fa-globe-asia"></i>
                </div>
              </div>
            </div>
            <div class="comment-detail">Đẹp trai ghê</div>
            <div class="reply">
              <div class="comment-react">Thích</div>
              <div class="comment-reply">Phản hồi</div>
            </div>
          </div>
          <div class="comment-wrapper">
            <div class="comment-container">
              <div class="comment">
                <div class="user">
                  <img
                    src="../../static/images/SHIP 2.png"
                    class="user-image"
                    alt=""
                  />
                  <div class="user-detail">
                    <div class="username">Trần Thùy Trang</div>
                    <div class="time-comment">
                      30 phút trước · <i class="fas fa-globe-asia"></i>
                    </div>
                  </div>
                </div>
                <div class="comment-detail">Đẹp trai ghê</div>
                <div class="reply">
                  <div class="comment-react">Thích</div>
                  <div class="comment-reply">Phản hồi</div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="post-comment">
          <div class="input-cover">
            <img
              src="../../static/images/SHIP 2.png"
              class="user-image"
              alt=""
            />
            <input
              type="text"
              name="postComment"
              id=""
              placeholder="Viết bình luận tại đây..."
            />
          </div>
          <div class="up-img">
            <input
              type="file"
              hidden
              multiple="false"
              id="upFile"
              accept="image/*"
            />
            <label for="upFile">
              <ion-icon name="camera-outline"></ion-icon>
            </label>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<div
  style="
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100%;
  "
  id="loading"
>
  <img
    src="/static/images/loading.svg"
    style="width: 70px; height: 70px; margin: 0 auto; display: block"
  />
</div>
<script>
  const heart = document.querySelector(".heart");
  const num = document.querySelectorAll(".number");
  heart.addEventListener("click", function () {
    if (heart.className === "far fa-heart heart") {
      heart.className = "fas fa-heart heart";
      heart.style.color = "red";
      num[0].innerHTML = parseInt(num[0].innerHTML) + 1;
    } else {
      heart.className = "far fa-heart heart";
      heart.style.color = "#676669";
      num[0].innerHTML = parseInt(num[0].innerHTML) - 1;
    }
  });
</script>
<script src="/utils/redirect.js"></script>
<script>
  $("#page-title").text("Cuộc thảo luận - JPro");
</script>
